from apis.chat.gpt.retrieval import retrieve_with_embedding, retrieve_with_prompt

questions = """Q10胶囊有什么副作用吗？(1)
钙片需要每天吃几粒？(2)
这个液体钙片对缓解骨折有帮助吗？(2)
夜间酵素需要空腹吃吗？(3)
这个酵素能提高新陈代谢吗？(3)
羊胎素胶囊对女性的皮肤有什么好处？(4)
请问这个羊胎素胶囊需要多久才能看到效果？(4)
护肝片可以治疗肝炎吗？(5)
这个护肝片适合长期服用吗？(5)
纯南极磷虾油和普通鱼油有什么区别？(6)
这个磷虾油可以改善记忆力吗？(6)
这个富硒片是适合什么人群的？(7)
富硒片能提高免疫力吗？(7)
请问这个益生菌需要冰箱保存吗？(8)
成年人每天需要吃多少益生菌？(8)
虾青素有什么作用？(10)
这个虾青素胶囊对眼睛有保护作用吗？(10)
黑蜂胶软胶囊可以提高抵抗力吗？(11)
请问这个黑蜂胶软胶囊要怎么保存？(11)
羊奶粉适合什么年龄段的孩子？(12)
俄罗斯蓝胖子羊奶粉跟牛奶粉有什么不同？(12)
抗糖丸能帮助减少糖分摄入吗？(13)
请问这个抗糖丸对糖尿病患者有帮助吗？(13)
大马膏可以缓解关节炎症吗？(14)
使用马栗按摩凝胶需要注意什么？(14)
小苏打牙膏对牙齿有什么好处？(15)
这个牙膏适合敏感牙齿使用吗？(15)
防晒霜能防水吗？(16)
熊防晒霜适合油性皮肤使用吗？(16)
花王马桶去污清洁剂对马桶有腐蚀性吗？(17)
请问这个去污剂需要稀释使用吗？(17)
elleair纸巾对皮肤过敏的宝宝适合吗？(18)
这个保湿纸巾可以用在宝宝的脸上吗？(18)
Q10胶囊建议餐后服用还是餐前服用？(1)
Schiff液体钙片是否含有乳制品成分？(2)
ISDG夜间酵素可以和其他保健品一起服用吗？(3)
biowell羊胎素胶囊适合孕妇使用吗？(4)
NYO3护肝片对预防肝硬化有帮助吗？(5)
NYO3磷虾油和Omega-3有什么不同？(6)
Biowell富硒片对甲状腺功能低下有帮助吗？(7)
viyouth益生菌可以改善便秘症状吗？(8)
MDC小腰精酵素可以在运动时一起服用吗？(9)
澳乐维他虾青素胶囊是否适合孕妇服用？(10)
SpringLeaf黑蜂胶软胶囊可以预防感冒吗？(11)
俄罗斯蓝胖子羊奶粉是否含有添加剂？(12)
ISDG抗糖丸对控制血糖有多大效果？(13)
德国大马膏可以缓解肌肉疲劳吗？(14)
意大利进口小苏打牙膏是否含有氟化物？(15)
Q10胶囊能改善心律失常吗？(1)
这个补钙产品适合孕妇吃吗？(2)
酵素产品有助于消化吗？(3)
这个羊胎素对皱纹有改善作用吗？(4)
护肝片是否对肝脏有保护作用？(5)
磷虾油产品可以降低胆固醇吗？(6)
这个富硒产品有抗氧化作用吗？(7)
益生菌产品可以改善肠道菌群吗？(8)
这个酵素有助于燃烧脂肪吗？(9)
虾青素产品对视力有保护作用吗？(10)
黑蜂胶软胶囊可以提高抗病能力吗？(11)
羊奶粉中的营养成分有什么？(12)
这个抗糖产品可以帮助控制体重吗？(13)
大马膏能缓解肌肉酸痛吗？(14)
小苏打牙膏可以去除口腔异味吗？(15)
这个防晒霜的防晒系数是多少？(16)
马桶去污清洁剂需要多久起效？(17)
这款纸巾是否可以长期使用？(18)
Q10胶囊的保质期是多久？(1)
这个液体钙片会引起便秘吗？(2)
夜间酵素需要长期服用才能看到效果吗？(3)
羊胎素胶囊的主要成分是什么？(4)
护肝片服用多久可以看到效果？(5)
磷虾油对心血管健康有什么好处？(6)
富硒片可以补充人体所需的硒吗？(7)
益生菌产品的最佳服用时间是什么时候？(8)
酵素产品对排毒有帮助吗？(9)
虾青素胶囊能改善皮肤黄褐斑吗？(10)
黑蜂胶软胶囊是否可以长期服用？(11)
羊奶粉与牛奶粉的营养成分有何不同？(12)
抗糖产品适合糖尿病患者吃吗？(13)
大马膏对腱鞘炎有改善作用吗？(14)
小苏打牙膏对牙齿美白有帮助吗？(15)
防晒霜适合敏感皮肤使用吗？(16)
马桶去污清洁剂是否环保安全？(17)
这款纸巾是否容易造成皮肤过敏？(18)
Q10胶囊是否可以和其他药物一起服用？(1)
这个补钙产品是否适合乳糖不耐受者？(2)
酵素产品对于排便是否有帮助？(3)
羊胎素胶囊是否含有激素？(4)
护肝片是否对肝脏解毒有帮助？(5)
磷虾油产品对预防心脏病有作用吗？(6)
富硒片是否可以提高人体抗氧化能力？(7)
益生菌产品是否可以改善腹泻症状？(8)
这个酵素产品是否可以提高新陈代谢？(9)
虾青素胶囊是否对眼睛疲劳有缓解作用？(10)
黑蜂胶软胶囊对伤口愈合有帮助吗？(11)
羊奶粉是否适合婴儿食用？(12)
抗糖产品能否帮助控制血糖波动？(13)
大马膏是否适合孕妇使用？(14)
小苏打牙膏能消除口腔炎症吗？(15)
防晒霜是否防汗防水？(16)
马桶去污清洁剂对水管会造成堵塞吗？(17)
这款纸巾是否可用于卸妆？(18)
Q10胶囊的主要作用是什么？(1)
补钙产品是否含有维生素D？(2)
酵素产品是否有助于消化不良？(3)
羊胎素胶囊能提高免疫力吗？(4)
护肝片是否可以预防酒精性肝炎？(5)
磷虾油产品对血管健康有何好处？(6)
富硒片可以提高免疫力吗？(7)
益生菌产品对肠道功能有何改善？(8)
酵素产品对脂肪分解有帮助吗？(9)
虾青素胶囊是否有抗氧化作用？(10)
黑蜂胶软胶囊能提高免疫力吗？(11)
羊奶粉是否适合成人食用？(12)
抗糖产品是否有助于控制饮食中的糖摄取？(13)
大马膏可以用于关节炎患者吗？(14)
小苏打牙膏是否有抗菌作用？(15)
防晒霜对干性皮肤适合吗？(16)
马桶去污清洁剂是否可以用于其他卫生间清洁？(17)
这款纸巾是否可以用于敏感皮肤？(18)
Q10胶囊是否有助于减缓衰老？(1)
补钙产品中是否含有锌元素？(2)
酵素产品适合年轻人服用吗？(3)
羊胎素胶囊的副作用有哪些？(4)
护肝片是否对吸烟者有保护作用？(5)
磷虾油产品是否适合高血压患者？(6)
富硒片是否可以预防心脏病？(7)
益生菌产品对改善便秘有多大帮助？(8)
酵素产品是否有助于提高新陈代谢速率？(9)
虾青素胶囊是否可以提高皮肤弹性？(10)
黑蜂胶软胶囊对过敏性鼻炎有改善作用吗？(11)
羊奶粉与牛奶粉的口感有何区别？(12)"""

def parse_questions(questions):
    # Everything before the first ( is the question.
    # Number between parhentheses is the answer number.
    
    q_and_a = []
    
    for line in questions.split('\n'):
        try:
            question = line.split('(')[0]
            answer = line.split('(')[1].split(')')[0]
        except Exception as e:
            print(e, line)
        
        q_and_a.append((question, answer))
    
    return q_and_a

def benchmark():
    print('Benchmarking...')
    
    methods = [retrieve_with_embedding, retrieve_with_prompt]
    method_to_correct = {}
    for m in methods:
        method_to_correct[m.__name__] = 0
    
    q_and_a = parse_questions(questions)
    count = 1
    for q, a in q_and_a:
        print(f"Question {count} of {len(q_and_a)}")
        count += 1
        for m in methods:
            _, ans_pred = m(q)
            ans_pred = int(ans_pred)
            if ans_pred == int(a):
                method_to_correct[m.__name__] += 1
    
    # Print function names and accuracies
    for m in methods:
        print(m.__name__, method_to_correct[m.__name__] / len(q_and_a))
        
if __name__ == '__main__':
    benchmark()